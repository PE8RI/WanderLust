<% layout("layouts/boilerplate") %>

<body class="bg-light">
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-8">

        <!-- Page Title -->
        <h3 class="text-center mb-4 text-primary fw-bold"><%= listing.title %></h3>

        <!-- Listing Card -->
        <div class="card shadow-lg border-0 rounded-4 listing-card">
          <img src="<%= listing.image %>" class="card-img-top rounded-top-4 img-fluid"
               alt="<%= listing.title %>" style="height: 250px; object-fit: cover;" />

          <div class="card-body">
            <p class="card-text text-muted">@<%= listing.owner.username%></p>
            <p class="card-text text-muted"><%= listing.description %></p>

            <ul class="list-group list-group-flush mb-3">
              <li class="list-group-item"><strong>Price:</strong> â‚¹<%= listing.price.toLocaleString("en-IN") %></li>
              <li class="list-group-item"><strong>Location:</strong> <%= listing.location %></li>
              <li class="list-group-item"><strong>Country:</strong> <%= listing.country %></li>
            </ul>
            <%if(currentUser && currentUser._id.equals(listing.owner._id)){%>
              <div class="d-flex justify-content-between">
                <a href="/listings/<%= listing._id %>/edit" class="btn btn-warning px-4">
                  <i class="fa fa-edit"></i> Edit
                </a>
  
                <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE">
                  <button type="submit" class="btn btn-danger px-4">
                    <i class="fa fa-trash"></i> Delete
                  </button>
                </form>
              </div>
            <%}%>
             
          </div>
        </div>

        <!-- Review Section -->
         
        <div class="mt-5 review-section">
          <h4 class="text-center text-success fw-bold mb-3">Leave a Review</h4>
        
          <% if(currentUser){ %>
            <form method="POST"
                  action="/listings/<%= listing._id %>/reviews"
                  class="card p-4 shadow-sm rounded-4 bg-white needs-validation"
                  novalidate>
              
              <!-- Rating -->
              <div class="mb-3">
                <label class="form-label fw-semibold">Rating (1â€“5)</label>
                <select name="review[rating]" class="form-select" required>
                  <option value="">Select Rating</option>
                  <% for (let i = 1; i <= 5; i++) { %>
                    <option value="<%= i %>"><%= i %></option>
                  <% } %>
                </select>
              </div>
        
              <!-- Comment -->
              <div class="mb-3">
                <label class="form-label fw-semibold">Comment</label>
                <textarea name="review[comment]"
                          class="form-control"
                          rows="3"
                          required></textarea>
              </div>
        
              <!-- Submit -->
              <button type="submit" class="btn btn-primary w-100">Submit Review</button>
            </form>
          <% } %>
        
        </div>
        
 
        <!-- ðŸ§© All Reviews Section -->
        <p><b>Reviews</b></p>
         <div class="row"> 
          <% for(review of listing.reviews){%>
              <div class="card col-5 ms-3 mb-3">
                <div class="card-body">
                  <h5 class="card-title"><%=review.Author.username%></h5>
                  <p class="card-text"><%=review.comment%></p>
                  <p class="card-text"><%=review.rating%> star</p>
                  <%if(currentUser && currentUser._id.equals(review.Author._id)){%>
                </div>
                <form class="mb-3" method="POST" action="/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE">
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
               </div>
              <%}%>
          <%}%>
        </div>
        <br><br>

        